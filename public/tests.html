<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en-gb"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en-gb"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en-gb"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en-gb"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Nice to have tests ;-)</title>

  <link rel="stylesheet" href="/css/test/qunit-1.10.0.css"/>

    <script src="/Kickstrap/js/jquery-1.8.3.min.js"></script>
    <script src="https://api.trello.com/1/client.js?key=afaec27e30009b0b1cfb14d85f384ee1"></script>
    <script src="/js/knockout-2.2.0.js"></script>
</head>
<body>
<div id="qunit"></div>
<div id="qunit-fixture"></div>
<script src="/js/test/sinon-1.5.2.js"></script>
<script src="/js/test/qunit-1.10.0.js"></script>
<script src="/js/model/card.js"></script>
<script src="/js/model/persistence.js"></script>
<script>
    function stubCard(id) {
        return new Card({id: id}, 0, 1);
    }

    module("persistence: moves to top",
            {
                setup: function() {

                },
                teardown: function() {

                }
            });

    test( "single move of single card", function() {
        var p = new Persistence();

        deepEqual(p.pendingMovesToTop(),
                  []);

        p.movedToTop("foo", [ stubCard(1) ]);

        deepEqual(p.pendingMovesToTop(),
                  [
                    { listId: "foo", cardId: 1 }
                  ]);
    });

    test( "single move with multiple cards", function() {
        var p = new Persistence();

        deepEqual(p.pendingMovesToTop(),
                []);

        p.movedToTop("foo", [ stubCard(1), stubCard(2) ]);

        deepEqual(p.pendingMovesToTop(),
                [
                    { listId: "foo", cardId: 2 },
                    { listId: "foo", cardId: 1 }
                ]);
    });

    test( "multiple moves of single cards", function() {
        var p = new Persistence();

        deepEqual(p.pendingMovesToTop(),
                []);

        p.movedToTop("foo", [ stubCard(2) ]);
        p.movedToTop("foo", [ stubCard(1) ]);

        deepEqual(p.pendingMovesToTop(),
                [
                    { listId: "foo", cardId: 2 },
                    { listId: "foo", cardId: 1 }
                ]);
    });

    test( "multiple moves of multiple cards", function() {
        var p = new Persistence();

        deepEqual(p.pendingMovesToTop(),
                []);

        p.movedToTop("foo", [ stubCard(3), stubCard(4) ]);
        p.movedToTop("foo", [ stubCard(1), stubCard(2) ]);

        deepEqual(p.pendingMovesToTop(),
                [
                    { listId: "foo", cardId: 4 },
                    { listId: "foo", cardId: 3 },
                    { listId: "foo", cardId: 2 },
                    { listId: "foo", cardId: 1 }
                ]);
    });

    test( "multiple moves of multiple cards, with some cards shared across moves", function() {
        var p = new Persistence();

        deepEqual(p.pendingMovesToTop(),
                []);

        p.movedToTop("foo", [ stubCard(3), stubCard(4) ]);
        p.movedToTop("foo", [ stubCard(1), stubCard(2) ]);
        p.movedToTop("foo", [ stubCard(2), stubCard(1) ]);

        deepEqual(p.pendingMovesToTop(),
                [
                    { listId: "foo", cardId: 4 },
                    { listId: "foo", cardId: 3 },
                    { listId: "foo", cardId: 2 },
                    { listId: "foo", cardId: 1 },
                    { listId: "foo", cardId: 1 },
                    { listId: "foo", cardId: 2 }
                ]);
    });
</script>
</body>
</html>
