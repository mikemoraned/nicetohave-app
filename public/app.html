<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en-gb"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en-gb"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en-gb"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en-gb"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Nice to have</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
  <!-- You can also compile style.less to use regular css. Your apps will still work. -->
  <style type="text/css">body{padding-top:60px}.hidden{margin:20px;border:5px solid #a24c4c;background-color:red;padding:10px;width:400px;color:white;font-family:helvetica,sans-serif}</style>
  <link rel="stylesheet/less" type="text/css" href="../kickstrap.less">
  <script src="../Kickstrap/js/less-1.3.0.min.js"></script>
  <script src="js/d3.v3.min.js"></script>
  <script src="../Kickstrap/js/jquery-1.8.3.min.js"></script>
  <script src="https://api.trello.com/1/client.js?key=afaec27e30009b0b1cfb14d85f384ee1"></script>
  <script src="js/knockout-2.2.0.js"></script>
  <script src="js/model/card.js"></script>
  <script src="js/model/list.js"></script>
  <script src="js/model/board.js"></script>

  <script src="js/ko.binding-handlers.js"></script>
  <script src="js/d3.categorise.view.js"></script>
  <style>
      svg {
          /*border: 1px solid;*/
      }

      circle.card {
          stroke: #fff;
          stroke-width: 1.5px;
      }

      circle.card.highlighted {
          stroke: red;
      }

      .selecting circle.card {
          fill-opacity: .2;
      }

      .selecting circle.card.selected {
          stroke: #f00;
      }

      div.card {
          margin-bottom: 5px;
      }

      div.card.highlighted {
          background-color: red;
      }

      .selecting div.card {
          opacity:.2;
      }

      .selecting div.card.selected {
          opacity: 1.0;
      }

      .brush .extent {
          stroke: #fff;
          fill-opacity: .125;
          shape-rendering: crispEdges;
      }

      table#area, div.cards {
          height: 500px;
      }

      div.cards {
          overflow: auto;
      }

      table#area thead th {
          padding:15px;
      }

      table#area tbody th {
          padding:15px;
      }

      table#area tbody .area.even {
          background-color: rgb(243, 253, 255);
      }
      table#area tbody .area.uncategorized {
          background-color: rgb(197, 228, 230);
      }
  </style>
</head>
<body>
<div id="sf-wrapper"> <!-- Sticky Footer Wrapper -->
  <!-- Prompt IE 6/7 users to install Chrome Frame. Remove this if you support IE 7-.
       chromium.org/developers/how-tos/chrome-frame-getting-started -->
  <!--[if lt IE 8]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
<!--! END KICKSTRAP HEADER -->


    <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <a class="brand" href="#">Nice to have</a>
                <div class="nav-collapse">
                    <ul class="nav">
                        <li><a href="/">Home</a></li>
                        <li class="active"><a href="app.html">The App</a></li>
                    </ul>
                </div><!--/.nav-collapse -->
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="span12 load">
                <input data-bind="value: board.id" />

                <button class="btn" data-bind="click: useBoard"><i class="icon-refresh"></i> Use this</button>
            </div>

            <section class="row">
                <div class="span7 board">
                    <span data-bind="text: board.name"></span>
                </div>
                <div class="span5 lists">
                    <select data-bind="options: board.lists, value: selectedList, optionsText: 'name', enable: board.lists().length > 0"></select>
                </div>
            </section>

            <section class="row">
                <div class="span7">
                    <table id="area" cellspacing="0" cellpadding="0">
                        <col width="10%"/>
                        <col width="30%"/>
                        <col width="30%"/>
                        <col width="30%"/>
                        <thead>
                            <tr>
                                <th></th>
                                <th scope="col">Nice to Have</th>
                                <th scope="col">Significant Business Value</th>
                                <th scope="col">Critical</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">Low risk</th>
                                <td class="area even origin"></td>
                                <td class="area odd"></td>
                                <td class="area even"></td>
                            </tr>
                            <tr>
                                <th scope="row">Medium risk</th>
                                <td class="area odd"></td>
                                <td class="area even"></td>
                                <td class="area odd"></td>
                            </tr>
                            <tr>
                                <th scope="row">High risk</th>
                                <td class="area even"></td>
                                <td class="area odd"></td>
                                <td class="area even"></td>
                            </tr>
                            <tr>
                                <th scope="row">Uncategorized</th>
                                <td class="area uncategorized"></td>
                                <td class="area uncategorized"></td>
                                <td class="area uncategorized"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="span5 cards">
                    <div data-bind="visible: selectedList, with: selectedList">
                        <h3>Cards: <span data-bind="text: cards().length"></span></h3>

                        <button class="span5 btn btn-mini btn-primary" type="button" data-bind="click: moveSelectedToTop, enable: hasSelected"><i class="icon-arrow-up"></i> </button>

                        <div class="list" data-bind="foreach: cards">
                            <div class="card row" data-bind="scrollToWhen: highlighted, scrollable:'.cards', css: { selected: selected, highlighted: highlighted }">
                                <button class="span1 btn btn-mini btn-primary" type="button" data-bind="click: addToArea"><i class="icon-arrow-left"></i> </button>
                                <div class="span4" data-bind="text: name"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </div>

<script type="application/javascript">

$(function() {
    function NiceToHaveAppViewModel(categoriseView) {
        // Data
        var self = this;
        self.board = new Board("506b4237ead39f966c0d2f34");
//        self.board = new Board("4ed7e27fe6abb2517a21383d");
        self.list = new List({id: "4eea755f1576578f2713ec56"});
        self.selectedList = ko.observable();
        self.loggedIn = ko.observable(Trello.authorized());

        self.selectedList.subscribe(function(list){
            console.log("Selected list changed");
            list.cardsInArea.subscribe(function(cards) {
                categoriseView.update(cards);
            });
            list.refresh();
        });

        // Operations
        self.useBoard = function() {
            console.log("Update board: " + self.board.id());
            self.board.refresh();
        }
    }

    var $board = $("#area");
    var boardOffset = $board.offset();
    var boardDimension = {
        width: $board.width(),
        height: $board.height()
    };
    var originOffset = $("#area .origin").offset();

    var width = boardDimension.width - (originOffset.left - boardOffset.left);
    var height = boardDimension.height - (originOffset.top - boardOffset.top);

    var categoriseView = new D3CategoriseView(originOffset.top, originOffset.left, width, height);

    var model = new NiceToHaveAppViewModel(categoriseView);

    ko.applyBindings(model);

    Trello.authorize({
        interactive:false,
        success: model.updateLoggedIn
    });
});

</script>

  <!--! KICKSTRAP FOOTER -->
   <div class="hidden"><h1>No Stylesheet Loaded</h1><p><strong>Could not load Kickstrap.</strong>There are <a href="http://getkickstrap.com/docs/1.2/troubleshooting/#lessjs-errors">several common reasons for this error.</a></p></div>
  <div id="push"></div></div> <!-- sf-wrapper -->
  <footer class="container" id="footer">
	  <p>Built with <a href="http://getkickstrap.com">Kickstrap</a></p>
  </footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="Kickstrap/js/jquery-1.8.2.min.js"><\/script>');</script>
  <!-- Kickstrap CDN thanks to our friends at netDNA.com -->
  <script id="appList" src="//netdna.getkickstrap.com/1.2/Kickstrap/js/kickstrap.min.js"></script>
  <script>window.ks || document.write('<script id="appList" src="../Kickstrap/js/kickstrap.min.js"><\/script>')</script>
  <script>

  </script>
  <!-- Asynchronous Google Analytics snippet. Change UA-XXXXX-X to be your site's ID.
       mathiasbynens.be/notes/async-analytics-snippet -->
  <!--script>
    var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script-->
</body>
</html>
